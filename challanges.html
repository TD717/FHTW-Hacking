<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Home</title>
  <script>
    fetch('./include/links.html')
      .then(response => response.text())
      .then(data => {
        document.head.insertAdjacentHTML('beforeend', data);
      })
      .catch(error => console.error('Error loading head links:', error));
  </script>
</head>
<body>
  <div id="header"></div>

  <!-- Title Section -->
  <div class="bg-dark text-white py-3">
    <div class="container d-flex flex-column align-items-center text-center py-5">
      <h1 class="fw-bold">Challenges</h1>
    </div>
  </div>

  <!-- Debug Token Section -->
  <div class="bg-secondary text-white py-2">
    <div class="container">
      <div class="row">
        <div class="col">
          <h5>Debug Information</h5>
          <div id="token-display" class="bg-dark p-2 rounded small" style="word-break: break-all; max-height: 100px; overflow-y: auto;">
            Loading token information...
          </div>
          <button id="copy-token" class="btn btn-sm btn-primary mt-2">Copy Token</button>
        </div>
      </div>
    </div>
  </div>

  <div class="text-white py-5">
    <div class="container d-flex flex-column align-items-center text-center py-5">
      <p class="fw-lighter fs-5 mb-5" style="max-width: 800px;">
        Loading challenges...
      </p>
    </div>
  </div>

  <div id="challenges-container" class="container py-3">
    <!-- Challenges will be loaded here -->
  </div>

  <div id="footer"></div>

  <script>
    fetch('./include/navbar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header').innerHTML = data;
      })
      .catch(error => console.error('Error loading header:', error));

    fetch('./include/footer.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('footer').innerHTML = data;
      })
      .catch(error => console.error('Error loading footer:', error));
  </script>

  <!-- Load scripts -->
  <script>
    fetch('./include/scripts.html')
      .then(response => response.text())
      .then(data => {
        const temp = document.createElement('div');
        temp.innerHTML = data;
        Array.from(temp.querySelectorAll('script')).forEach(oldScript => {
          const newScript = document.createElement('script');
          Array.from(oldScript.attributes).forEach(attr => {
            newScript.setAttribute(attr.name, attr.value);
          });
          newScript.textContent = oldScript.textContent;
          document.body.appendChild(newScript);
        });
      })
      .catch(error => console.error('Error loading scripts:', error));
  </script>
  
  <!-- Token display script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const tokenDisplay = document.getElementById('token-display');
      const copyButton = document.getElementById('copy-token');
      
      // Display token info
      function updateTokenDisplay() {
        const token = localStorage.getItem('jwtToken');
        const username = localStorage.getItem('username');
        
        if (token) {
          // Display token and basic info
          tokenDisplay.innerHTML = `
            <div><strong>Username:</strong> ${username || 'Not found'}</div>
            <div><strong>Token:</strong> ${token}</div>
          `;
          
          // Try to decode and display token payload
          try {
            const payload = JSON.parse(atob(token.split('.')[1]));
            const expDate = payload.exp ? new Date(payload.exp * 1000).toLocaleString() : 'Not found';
            
            tokenDisplay.innerHTML += `
              <div class="mt-2"><strong>Expiration:</strong> ${expDate}</div>
              <div><strong>Payload:</strong> <pre>${JSON.stringify(payload, null, 2)}</pre></div>
            `;
          } catch (error) {
            tokenDisplay.innerHTML += `<div class="text-warning">Unable to decode token: ${error.message}</div>`;
          }
        } else {
          tokenDisplay.innerHTML = '<div class="text-danger">No JWT token found in localStorage</div>';
        }
      }
      
      // Copy token to clipboard
      if (copyButton) {
        copyButton.addEventListener('click', function() {
          const token = localStorage.getItem('jwtToken');
          if (token) {
            navigator.clipboard.writeText(token)
              .then(() => {
                alert('Token copied to clipboard');
              })
              .catch(err => {
                console.error('Failed to copy token: ', err);
              });
          } else {
            alert('No token to copy');
          }
        });
      }
      
      // Update display when page loads
      updateTokenDisplay();
    });
  </script>
  
  <!-- Authentication scripts -->
  <script src="./js/auth.js"></script>
  <script src="./js/challenge.js"></script>
</body>
</html>
